sudo : required
dist: trusty

services:
  - docker

cache:
  directories:
  - $HOME/.stack

matrix:
  include:
    - env: CABALVER=1.22 GHCVER=7.10.3
      addons: {apt: {packages: [cabal-install-1.22,ghc-7.10.3],sources: [hvr-ghc]}}

before_install:
# Download and unpack the stack available
  - mkdir -p ~/.local/bin
  - export PATH=$HOME/.local/bin:$PATH
  - travis_retry curl -L https://www.stackage.org/stack/linux-x86_64 | tar xz --wildcards --strip-components=1 -C ~/.local/bin '*/stack'
  - chmod a+x ~/.local/bin/stack
# Disable conflicting services
  - sudo service postgresql stop

install:
  - (cd terrarium && stack setup --no-terminal)

script:
  - docker-compose build
  - docker-compose up -d
  - (cd terrarium && stack test --no-terminal)
  - (cd terrarium && stack build --no-terminal)

after_script:
 - docker-compose down
